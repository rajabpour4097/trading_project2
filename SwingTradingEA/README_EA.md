# Swing Trading Expert Advisor (MQL5)

## نگاه کلی

این Expert Advisor (EA) بر اساس کد Python موجود در `main_metatrader.py` طراحی شده و استراتژی Swing Trading با استفاده از تحلیل Leg ها و سطوح Fibonacci را پیاده‌سازی می‌کند.

## فایل‌های اصلی

1. **SwingTradingEA.mq5** - نسخه اصلی EA
2. **SwingTradingEA_Enhanced.mq5** - نسخه پیشرفته با قابلیت‌های اضافی
3. **SwingTradingConfig.mqh** - فایل تنظیمات
4. **SwingTradingHelpers.mqh** - توابع کمکی

## نحوه نصب

1. فایل‌های MQL5 را در پوشه `MQL5/Experts/` کپی کنید
2. فایل‌های `.mqh` را در پوشه `MQL5/Include/` قرار دهید
3. MetaEditor را باز کرده و EA را کامپایل کنید
4. EA را روی چارت مورد نظر اعمال کنید

## پارامترهای ورودی

### پارامترهای معاملاتی
- **InpLotSize**: حجم معامله (پیش‌فرض: 0.01)
- **InpWinRatio**: نسبت سود به ضرر (پیش‌فرض: 1.2)
- **InpThreshold**: آستانه تشخیص Leg بر حسب pip (پیش‌فرض: 6)
- **InpWindowSize**: اندازه پنجره داده (پیش‌فرض: 100)
- **InpFib705**: سطح Fibonacci 70.5% (پیش‌فرض: 0.705)
- **InpFib90**: سطح Fibonacci 90% (پیش‌فرض: 0.9)

### مدیریت ریسک
- **InpMaxRiskPercent**: حداکثر ریسک هر معامله (پیش‌فرض: 2%)
- **InpMaxSpread**: حداکثر spread مجاز (پیش‌فرض: 3.0)
- **InpUseTrailingStop**: استفاده از Trailing Stop
- **InpTrailingStopPips**: فاصله Trailing Stop

### تنظیمات زمانی
- **InpStartTime**: شروع معاملات (ساعت ایران)
- **InpEndTime**: پایان معاملات (ساعت ایران)
- **InpUseLondonSession**: معامله در جلسه لندن
- **InpUseNYSession**: معامله در جلسه نیویورک
- **InpUseOverlapOnly**: معامله فقط در همپوشانی لندن-نیویورک

## منطق استراتژی

### 1. تشخیص Leg ها
- تحلیل حرکات قیمت بر اساس آستانه تعریف شده
- شناسایی جهت حرکت (up/down)
- اعتبارسنجی Leg ها بر اساس تعداد کندل و حجم

### 2. تحلیل Swing
- شناسایی الگوهای Swing صعودی و نزولی
- اعتبارسنجی با تحلیل کندل‌های bearish/bullish
- محاسبه سطح اطمینان برای هر Swing

### 3. محاسبه Fibonacci
- محاسبه سطوح Fibonacci بر اساس نقاط Swing
- سطوح کلیدی: 0.0, 70.5%, 90%, 100%
- به‌روزرسانی پویا سطوح

### 4. سیگنال‌های ورود
- لمس اول سطح 70.5%
- لمس دوم با نوع کندل متفاوت = سیگنال ورود
- اعتبارسنجی شرایط بازار

### 5. مدیریت پوزیشن
- Stop Loss: سطح 90% یا 100% Fibonacci
- Take Profit: بر اساس نسبت Win Ratio
- Trailing Stop اختیاری
- انتقال به Break-even

## ویژگی‌های نسخه Enhanced

### مدیریت ریسک پیشرفته
- محاسبه اندازه پوزیشن بر اساس ریسک
- کنترل حداکثر Drawdown
- محدودیت تعداد معاملات روزانه

### نظارت و گزارش‌دهی
- آمار عملکرد real-time
- ارسال اطلاعیه‌های email
- پنل اطلاعات روی چارت

### فیلترهای اضافی
- فیلتر نوسانات بازار
- بررسی شرایط spread
- کنترل زمان‌بندی معاملات

## ساعات معاملاتی (بر اساس ساعت ایران)

- **جلسه سیدنی**: 05:30 - 14:30
- **جلسه توکیو**: 07:30 - 16:30  
- **جلسه لندن**: 12:30 - 21:30
- **جلسه نیویورک**: 17:30 - 02:30
- **همپوشانی لندن-نیویورک**: 17:30 - 21:30 (بهترین زمان)

## نحوه عملکرد

### فاز 1: تشخیص اولیه
```
1. دریافت داده‌های قیمت جدید
2. تحلیل و شناسایی Leg ها
3. بررسی تشکیل Swing
4. محاسبه سطوح Fibonacci
```

### فاز 2: رصد سیگنال
```
1. رصد لمس سطح 70.5%
2. بررسی نوع کندل در لمس اول
3. انتظار برای لمس دوم با کندل متفاوت
4. تولید سیگنال ورود
```

### فاز 3: اجرای معامله
```
1. اعتبارسنجی شرایط بازار
2. محاسبه اندازه پوزیشن
3. تعیین Stop Loss و Take Profit
4. اجرای دستور معامله
```

### فاز 4: مدیریت پوزیشن
```
1. نظارت بر پوزیشن باز
2. اعمال Trailing Stop
3. انتقال به Break-even
4. سود‌گیری تدریجی
```

## تنظیمات پیشنهادی

### برای مبتدیان
```
- Lot Size: 0.01
- Win Ratio: 1.2
- Max Risk: 1%
- Use London Session: True
- Use Overlap Only: True
```

### برای حرفه‌ای‌ها
```
- Lot Size: 0.1
- Win Ratio: 1.5
- Max Risk: 2%
- Use Trailing Stop: True
- Send Emails: True
```

## هشدارها و نکات مهم

⚠️ **نکات ایمنی:**
- همیشه از حساب Demo برای تست استفاده کنید
- ریسک را به 2% یا کمتر محدود کنید
- AutoTrading را در MT5 فعال کنید
- اتصال اینترنت پایدار داشته باشید

⚠️ **محدودیت‌ها:**
- فقط روی نماد EURUSD تست شده
- نیاز به spread کم (زیر 3 pip)
- بهترین عملکرد در جلسه لندن-نیویورک

## عیب‌یابی

### مشکلات رایج:

1. **EA معامله نمی‌کند:**
   - AutoTrading را بررسی کنید
   - ساعات معاملاتی را چک کنید
   - Spread را بررسی کنید

2. **خطاهای دستور معامله:**
   - موجودی حساب کافی باشد
   - Stop Level های broker را بررسی کنید
   - پارامترهای Lot Size را چک کنید

3. **عملکرد ضعیف:**
   - پارامترها را تنظیم کنید
   - ساعات معاملاتی را محدود کنید
   - فیلترهای اضافی فعال کنید

## سابقه تغییرات

### نسخه 1.0
- تبدیل اولیه از کد Python
- منطق اصلی Swing Trading
- سطوح Fibonacci اصلی

### نسخه 2.0 (Enhanced)
- مدیریت ریسک پیشرفته
- آمار و گزارش‌دهی
- فیلترهای اضافی
- بهبود عملکرد

## پشتیبانی

برای سوالات و مشکلات:
- بررسی فایل log ها در پوشه MT5
- استفاده از Journal و Experts tabs
- تست روی حساب Demo

## مجوز

این EA تحت مجوز آزاد توزیع می‌شود. استفاده تجاری آزاد است.

---

**تذکر**: این EA ابزار کمکی برای معاملات است و تضمینی برای سودآوری ندارد. همیشه از مدیریت ریسک مناسب استفاده کنید.
